on:
  workflow_call:

jobs:
  grype-scan:
    runs-on: ubuntu-latest
    permissions:
      security-events: write
    steps:
      - name: Checkout mainline
        uses: actions/checkout@master    
      - name: Run Grype vulnerability scanner
        id: scan
        uses: anchore/scan-action@v3
        with:
          image: "groundhog2k/distroless-base-image:verify"
          severity-cutoff: "low"
          fail-build: false
          output-format: "sarif"
      - name: Upload Grype scan results to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: ${{ steps.scan.outputs.sarif }}
          category: grype-scan
